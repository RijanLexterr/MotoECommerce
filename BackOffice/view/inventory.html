<div class="page-header">
  <h3 class="fw-bold mb-3">Inventory</h3>
  <ul class="breadcrumbs mb-3">
    <li class="nav-home">
      <a href="#">
        <i class="icon-home"></i>
      </a>
    </li>
    <li class="separator">
      <i class="icon-arrow-right"></i>
    </li>
    <li class="nav-item">
      <a href="#">Inventory</a>
    </li>
  </ul>
</div>
<div class="row" ng-controller="InventoryController">
  <div class="col-md-12">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <div class="card-title">Products</div>
        <button class="btn btn-success btn-sm" ng-click="openAddTransaction(null)"> + Add Transaction </button>
      </div>
      <div class="card-body">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Product Name</th>
              <th>Stock</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="item in Items track by item.product_id">
              <td>
                <a data-bs-toggle="collapse" href="#collapseRow{{$index}}" role="button" aria-expanded="false" aria-controls="collapseRow{{$index}}">
                  <span class="h5">
                    <i class="icon-information"></i> {{item.name}}
                  </span>
                </a>
                <!-- Collapsible: transactions -->
                <div class="collapse mt-2" id="collapseRow{{$index}}">
                  <div class="card card-body">
                    <div ng-include="'view/inventoryTransByPrdoducts.html'" ng-controller="InventoryTransactionsController" ng-init="init(item.product_id)"></div>
                  </div>
                </div>
              </td>
              <td>
                <span class="badge bg-info text-dark">{{item.stock}} pcs</span>
                <span class="badge bg-danger ms-2" ng-if="item.stock < 50">Low stock </span>
              </td>
            </tr>
          </tbody>
        </table>
        <!-- Pagination controls -->
        <div class="d-flex justify-content-between align-items-center mt-3">
          <div>
            <label>Show <select ng-model="pagination.pageSize" ng-change="changePageSize()" ng-options="s for s in [5,10,25,50]"></select> entries </label>
          </div>
          <div>
            <button class="btn btn-sm btn-secondary" ng-disabled="pagination.page === 1" ng-click="goToPage(pagination.page - 1)">Prev</button> Page {{pagination.page}} of {{pagination.totalPages}}
            <button class="btn btn-sm btn-secondary" ng-disabled="pagination.page === pagination.totalPages" ng-click="goToPage(pagination.page + 1)">Next</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Modal -->
<div class="modal fade" id="transactionFormModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form ng-submit="saveTransaction()">
        <div class="modal-header">
          <h5 class="modal-title">
            {{isEdit ? 'Edit Inventory Transaction' : 'Add Inventory Transaction'}}
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Product</label>
            <select class="form-select" ng-model="transaction.product_id" required>
              <option ng-repeat="p in DropdownItems track by p.product_id" value="{{p.product_id}}">
                {{p.name}}
              </option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Type</label>
            <select class="form-select" ng-model="transaction.type_id" required>
              <option value="1">IN</option>
              <option value="2">OUT</option>
              <option value="3">ADJUSTMENT</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Quantity</label>
            <input type="number" class="form-control" ng-model="transaction.qty">
          </div>
          <div class="mb-3">
            <label class="form-label">Remarks</label>
            <textarea class="form-control" ng-model="transaction.remarks"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Transaction</button>
        </div>
      </form>
    </div>
  </div>
</div>