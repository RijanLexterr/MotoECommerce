<div class="section">
  <!-- container -->
  <div class="container">
    <div class="container-fluid mt-4">
      <div class="row">

        <!-- Sidebar Accordion -->
        <div class="col-md-3">
          <div class="card shadow-sm border-0">
            <ul class="list-group list-group-flush">
              <li class="list-group-item border-0" ng-click="activeView = 'profile'"
                ng-class="{ 'bg-primary text-white': activeView === 'profile' }" style="cursor: pointer;">
                <a href="" class="text-decoration-none text-reset">Profile</a>
              </li>
              <li class="list-group-item border-0" ng-click="activeView = 'address'"
                ng-class="{ 'bg-primary text-white': activeView === 'address' }" style="cursor: pointer;">
                <a href="" class="text-decoration-none text-reset">Address</a>
              </li>
              <li class="list-group-item border-0" ng-click="activeView = 'purchases'"
                ng-class="{ 'bg-primary text-white': activeView === 'purchases' }" style="cursor: pointer;">
                <a href="" class="text-decoration-none text-reset">My Purchases</a>
              </li>
            </ul>
          </div>
        </div>

        <!-- Main Content Area -->
        <div class="col-md-9">

          <!-- Profile View -->
          <div ng-show="activeView === 'profile'">
            <h4>Profile</h4>

            <!-- Name -->
            <div class="mb-3">
              <label class="form-label">Name</label>
              <input type="text" class="form-control" ng-model="user.name"
                ng-class="{'is-invalid': showErrors && !user.name}">
              <div class="invalid-feedback">Name is required.</div>
            </div>

            <!-- Email -->
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" ng-model="user.email"
                ng-class="{'is-invalid': showErrors && !user.email}">
              <div class="invalid-feedback">Valid email is required.</div>
            </div>

            <!-- Password Section -->
            <div class="mb-3 d-flex justify-content-between align-items-center">
              <label class="form-label mb-0">Password</label>
              <a class="nav-item nav-link" type="button" data-bs-toggle="modal"
                data-bs-target="#passwordModal">Change</a>
            </div>

            <div class="d-flex justify-content-center">
              <button class="btn btn-primary" ng-click="submit()">Save</button>
            </div>

            <!-- Password Modal -->
            <div class="modal fade" id="passwordModal" tabindex="-1" aria-labelledby="passwordModalLabel"
              aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content" ng-controller="ProfileController">
                  <div class="modal-header">
                    <h5 class="modal-title" id="passwordModalLabel">Change Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                      ng-click="cancelChangePassword()"></button>
                  </div>
                  <div class="modal-body">

                    <!-- Old Password -->
                    <div class="mb-3">
                      <label class="form-label">Old Password</label>
                      <input type="password" class="form-control" ng-model="user.oldPassword"
                        ng-class="{'is-invalid': showErrors && (!user.oldPassword || passwordErrors.oldPassword)}">
                      <div class="invalid-feedback" ng-show="showErrors && !user.oldPassword">Old password is required.
                      </div>
                      <div class="text-danger" ng-show="passwordErrors.oldPassword">{{ passwordErrors.oldPassword }}
                      </div>
                    </div>

                    <!-- New Password -->
                    <div class="mb-3">
                      <label class="form-label">New Password</label>
                      <input type="password" class="form-control" ng-model="user.newPassword"
                        ng-class="{'is-invalid': showErrors && !user.newPassword}">
                      <div class="invalid-feedback" ng-show="showErrors && !user.newPassword">New password is required.
                      </div>
                    </div>

                    <!-- Confirm Password -->
                    <div class="mb-3">
                      <label class="form-label">Confirm Password</label>
                      <input type="password" class="form-control" ng-model="user.confirmPassword"
                        ng-class="{'is-invalid': showErrors && (!user.confirmPassword || passwordErrors.confirmPassword)}">
                      <div class="invalid-feedback" ng-show="showErrors && !user.confirmPassword">Confirm password is
                        required.</div>
                      <div class="text-danger" ng-show="passwordErrors.confirmPassword">{{
                        passwordErrors.confirmPassword }}
                      </div>
                    </div>

                  </div>
                  <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal"
                      ng-click="cancelChangePassword()">Cancel</button>
                    <button class="btn btn-primary" ng-click="submitPassword()">Save Password</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Address View -->
          <div ng-show="activeView === 'address'">
            <h4>Address</h4>
            <div class="add-user-btn-container d-flex justify-content-between align-items-center mb-3">
              <div>
                <input class="form-control" type="text" placeholder="search" ng-model="searchQuery">
              </div>
              <div>
                <button type="button" class="btn btn-primary btn-round ms-auto" data-bs-toggle="modal"
                  data-bs-target="#UserShippingDetailsCreateModal" ng-click="addUserShippingDetailsOnClick()">
                  <i class="fa fa-plus"></i>Add Shipping Details</button>
              </div>
            </div>

            <!-- Add User Modal -->
            <div class="modal fade" id="UserShippingDetailsCreateModal" data-bs-backdrop="static"
              data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" ng-show="!usershippingdetail.user_shipping_id"
                      id="UserShippingDetailsCreateModalLabel">Add Shipping Details</h5>
                    <h5 class="modal-title" ng-show="usershippingdetail.user_shipping_id"
                      id="UserShippingDetailsCreateModalLabel">Edit Shipping Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                      ng-click="updateUserShippingDetailsFields()" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <div class="mb-3">
                      <label for="usershippingdetail.fullname" class="form-label">Full Name</label>
                      <input type="text" class="form-control" id="usershippingdetail.fullname"
                        ng-model="usershippingdetail.fullname" ng-blur="validateName()" placeholder="Enter Full Name">
                      <span ng-show="nameHasError" style="color: red; font-size: 0.9em;">
                        {{nameError}}
                      </span>
                    </div>
                    <div class="mb-3">
                      <label for="usershippingdetail.phonenumber" class="form-label">Phone Number</label>
                      <input type="text" class="form-control" id="phonenumber" ng-model="usershippingdetail.phonenumber"
                        ng-blur="validatePhoneNumber()" placeholder="Enter Phone Number">
                      <span ng-show="PhoneNumberHasError" style="color: red; font-size: 0.9em;">
                        Phone Number is required.
                      </span>
                    </div>
                    <div class="mb-3">
                      <label for="usershippingdetail.address" class="form-label">Address</label>
                      <input type="text" class="form-control" id="address" ng-model="usershippingdetail.address"
                        ng-blur="validateAddress()" placeholder="Enter Address">
                      <span ng-show="AddressHasError" style="color: red; font-size: 0.9em;">
                        Address is required.
                      </span>
                    </div>
                    <div class="mb-3">
                      <label for="usershippingdetail.postalcode" class="form-label">Postal Code</label>
                      <input type="text" class="form-control" id="postalcode" ng-model="usershippingdetail.postalcode"
                        ng-blur="validatePostalCode()" placeholder="Enter Postal Code">
                      <span ng-show="PostalCodeHasError" style="color: red; font-size: 0.9em;">
                        Postal Code is required.
                      </span>
                    </div>
                    <div class="mb-3">
                      <label class="containerShipAdd">
                        <input type="checkbox" name="is_default_address"
                          ng-model="usershippingdetail.is_default_address">
                        Default Shipping Address
                        <span class="checkmarkShipAdd"></span>
                      </label>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                      ng-click="updateUserShippingDetailsFields()">Cancel</button>
                    <button ng-show="!usershippingdetail.user_shipping_id" type="button" class="btn btn-primary"
                      ng-click="submit()">Create</button>
                    <button ng-show="usershippingdetail.user_shipping_id" type="button" class="btn btn-primary"
                      ng-click="submit()">Save</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Delete Confirmation Modal -->
            <div class="modal fade" id="deleteUserShippingDetailsConfirmationModal" tabindex="-1"
              aria-labelledby="deleteUserShippingDetailsConfirmationModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="deleteUserShippingDetailsConfirmationModalLabel">Delete Shipping Details
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <p>Are you sure you want to delete this shipping details?</p>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                    <button type="button" class="btn btn-primary"
                      ng-click="deleteUserShippingDetailsById()">Yes</button>
                  </div>
                </div>
              </div>
            </div>

            <div>
              <form ng-submit="save">
                <table class="table">
                  <thead>
                    <tr>
                      <th scope="col">#</th>
                      <th scope="col">Full Name</th>
                      <th scope="col">Phone Number</th>
                      <th scope="col">Address</th>
                      <th scope="col">Postal Code</th>
                      <th scope="col">Default</th>
                      <th scope="col">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr ng-repeat="detail in usershippingdetails | filter:searchQuery">
                      <td>{{($index + 1) + ((pagination.page - 1) * pagination.limit)}}</td>
                      <td>{{detail.fullname}}</td>
                      <td>{{detail.phonenumber}}</td>
                      <td>{{detail.address}}</td>
                      <td>{{detail.postalcode}}</td>
                      <td>{{detail.Def_Address}}</td>
                      <td>
                        <div class="action-btn-container" style="display: flex; gap: 5px;">
                          <button type="button" class="btn btn-sm" ng-click="updateUserShippingDetailsOnClick(detail)"
                            data-bs-toggle="modal" data-bs-target="#UserShippingDetailsCreateModal">
                            <i class="fa fa-edit" data-bs-toggle="tooltip" title="Update"></i>
                          </button>
                          <button class="btn btn-sm" ng-click="deleteUserShippingDetailsOnClick(detail)"
                            data-bs-toggle="modal" data-bs-target="#deleteUserShippingDetailsConfirmationModal">
                            <i class="fa fa-times" data-bs-toggle="tooltip" title="Delete"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </form>
            </div>

            <!-- Pagination controls -->
            <div class="d-flex justify-content-between align-items-center mt-3">
              <div>
                <label>Show
                  <select ng-model="pageSize" ng-change="changePageSize()"
                    ng-options="s for s in [5,10,25,50]"></select>
                  entries
                </label>
              </div>
              <div>
                <button class="btn btn-sm btn-outline-primary" ng-disabled="pagination.page === 1"
                  ng-click="loadTransactions(pagination.page - 1)">
                  Prev
                </button>
                Page {{pagination.page}} of {{pagination.totalPages}}
                <button class="btn btn-sm btn-outline-primary" ng-disabled="pagination.page === pagination.totalPages"
                  ng-click="loadTransactions(pagination.page + 1)">next</button>

              </div>
            </div>
          </div>







          <!-- Purchases View -->
          <div ng-show="activeView === 'purchases'">
            <h4>My Purchases</h4>

            <div class="container mt-4">

              <!-- Tabs -->
              <ul class="nav nav-tabs mb-3">
                <li class="nav-item">
                  <a class="nav-link" ng-class="{ active: activeTab === 'toShip' }" ng-click="activeTab = 'toShip'"
                    style="cursor: pointer;">To Ship</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" ng-class="{ active: activeTab === 'toReceive' }"
                    ng-click="activeTab = 'toReceive'" style="cursor: pointer;">To Receive</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" ng-class="{ active: activeTab === 'completed' }"
                    ng-click="activeTab = 'completed'" style="cursor: pointer;">Completed</a>
                </li>
              </ul>

              <div ng-init="toShipOrders = (orders | filter:{order_status_name: 'Pending'})"></div>
              <div ng-init="toReceiveOrders = (orders | filter:{order_status_name: 'Shipped'})"></div>
              <div ng-init="completedOrders = (orders | filter:{order_status_name: 'Paid'})"></div>

              <!-- To Ship -->
              <div ng-show="activeTab === 'toShip'">
                <h5 class="mt-4">To Ship</h5>
                <div ng-if="toShipOrders.length === 0" class="text-center text-muted mt-4">
                  <p>No orders to ship at the moment.</p>
                </div>
                <div class="accordion" id="toShipAccordion">
                  <div class="accordion-item" ng-repeat="order in orders | filter:{order_status_name: 'Pending'}">
                    <h2 class="accordion-header" id="headingShip{{$index}}">
                      <a class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseShip{{$index}}" aria-expanded="false"
                        aria-controls="collapseShip{{$index}}">
                        Order #{{ order.order_id }}
                      </a>
                    </h2>
                    <div id="collapseShip{{$index}}" class="accordion-collapse collapse"
                      aria-labelledby="headingShip{{$index}}" data-bs-parent="#toShipAccordion">
                      <div class="accordion-body">
                        <div class="row mb-3" ng-repeat="item in order.items">
                          <div class="col-md-3">
                            <img style="width: 200px; height: 200px;"
                              ng-src="{{ (item.item_img_loc ? ('../BackOffice/uploads/' + item.item_img_loc) : 'assets/img/default.jpg') }}"
                              class="img-fluid rounded" alt="{{ item.item_brand_name }}">
                          </div>
                          <div class="col-md-6">
                            <h6>{{ item.item_brand_name }} - {{ item.item_category_name }}</h6>
                            <p class="text-muted">Qty: {{ item.item_qty }} × ₱{{ item.item_price }}</p>
                          </div>
                          <div class="col-md-3 text-end">
                            <strong>₱{{ item.item_total_amt | number:2 }}</strong>
                          </div>

                        </div>

                        <div class="d-flex justify-content-end border-top pt-3">
                          <h5>Total: ₱{{ getTotal(order.items) | number:2 }}</h5>
                        </div>

                      </div>
                    </div>
                    <hr class="accordion-separator">
                  </div>
                </div>
              </div>


              <!-- To Receive -->
              <div ng-show="activeTab === 'toReceive'">
                <h5 class="mt-4">To Receive</h5>
                <div ng-if="toReceiveOrders.length === 0" class="text-center text-muted mt-4">
                  <p>No orders to receive at the moment.</p>
                </div>
                <div class="accordion" id="toReceiveAccordion">
                  <div class="accordion-item" ng-repeat="order in orders | filter:{order_status_name: 'Shipped'}">
                    <h2 class="accordion-header" id="headingReceive{{$index}}">
                      <a class="accordion collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseReceive{{$index}}" aria-expanded="false"
                        aria-controls="collapseReceive{{$index}}">
                        Order #{{ order.order_id }}
                      </a>
                    </h2>
                    <div id="collapseReceive{{$index}}" class="accordion-collapse collapse"
                      aria-labelledby="headingReceive{{$index}}" data-bs-parent="#toReceiveAccordion">
                      <div class="accordion-body">
                        <div class="row mb-3" ng-repeat="item in order.items">
                          <div class="col-md-3">
                            <img style="width: 200px; height: 200px;"
                              ng-src="{{ (item.item_img_loc ? ('../BackOffice/uploads/' + item.item_img_loc) : 'assets/img/default.jpg') }}"
                              class="img-fluid rounded" alt="{{ item.item_brand_name }}">
                          </div>
                          <div class="col-md-6">
                            <h6>{{ item.item_brand_name }} - {{ item.item_category_name }}</h6>
                            <p class="text-muted">Qty: {{ item.item_qty }} × ₱{{ item.item_price }}</p>
                          </div>
                          <div class="col-md-3 text-end">
                            <strong>₱{{ item.item_total_amt | number:2 }}</strong>
                          </div>
                        </div>
                        <div class="d-flex justify-content-between align-items-center border-top pt-3">
                          <h5>Total: ₱{{ getTotal(order.items) | number:2 }}</h5>
                          <button class="btn btn-primary" ng-click="markAsReceived(order)">Received</button>
                        </div>
                      </div>
                    </div>
                    <hr class="accordion-separator">
                  </div>
                </div>
              </div>

              <!-- Completed -->
              <div ng-show="activeTab === 'completed'">
                <h5 class="mt-4">Completed</h5>
                <div ng-if="completedOrders.length === 0" class="text-center text-muted mt-4">
                  <p>No completed orders at the moment.</p>
                </div>
                <div class="accordion" id="completedAccordion">
                  <div class="accordion-item" ng-repeat="order in orders | filter:{order_status_name: 'Paid'}">
                    <h2 class="accordion-header" id="headingCompleted{{$index}}">
                      <a class="accordion collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseCompleted{{$index}}" aria-expanded="false"
                        aria-controls="collapseCompleted{{$index}}">
                        Order #{{ order.order_id }} - {{ order.order_created_at }}
                      </a>
                    </h2>
                    <div id="collapseCompleted{{$index}}" class="accordion-collapse collapse"
                      aria-labelledby="headingCompleted{{$index}}" data-bs-parent="#completedAccordion">
                      <div class="accordion-body">
                        <div class="row mb-3" ng-repeat="item in order.items">
                          <div class="col-md-3">
                            <img style="width: 200px; height: 200px;"
                              ng-src="{{ (item.item_img_loc ? ('../BackOffice/uploads/' + item.item_img_loc) : 'assets/img/default.jpg') }}"
                              class="img-fluid rounded" alt="{{ item.item_brand_name }}">
                          </div>
                          <div class="col-md-6">
                            <h6>{{ item.item_brand_name }} - {{ item.item_category_name }}</h6>
                            <p class="text-muted">Qty: {{ item.item_qty }} × ₱{{ item.item_price }}</p>
                          </div>
                          <div class="col-md-3 text-end">
                            <strong>₱{{ item.item_total_amt | number:2 }}</strong>
                          </div>
                        </div>
                        <div class="d-flex justify-content-end border-top pt-3">
                          <h5>Total: ₱{{ getTotal(order.items) | number:2 }}</h5>
                        </div>
                      </div>
                    </div>
                    <hr class="accordion-separator">

                  </div>
                </div>
              </div> <!-- End Completed Tab -->
            </div> <!-- End Container -->
          </div> <!-- End Purchases View -->
        </div> <!-- End col-md-9 -->
      </div> <!-- End row -->
    </div> <!-- End container-fluid -->
  </div>
</div>