<div ng-controller="CartOrderController">

	<!-- BREADCRUMB -->
	<div id="breadcrumb" class="section">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<h3 class="breadcrumb-header">Checkout</h3>
					<ul class="breadcrumb-tree">
						<li><a href="#/home">Home</a></li>
						<li class="active">Checkout</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	<!-- /BREADCRUMB -->

	<!-- SECTION -->
	<div class="section">
		<div class="container">
			<div class="row">

				<!-- BILLING DETAILS -->
				<div class="col-md-8">
					<div class="billing-details">
						<div class="section-title">
							<h3 class="title">Billing Address</h3>
						</div>
						<div class="form-group">
							<input class="input" type="text" name="first-name" placeholder="Name"
								ng-model="userWithAddresses[currentUser.user_id].Name">
						</div>
						<div class="form-group">
							<input class="input" type="text" name="email" placeholder="Email Address"
								ng-model="userWithAddresses[currentUser.user_id].Email">
						</div>
						<div class="form-group">
							<div class="mb-4">
								<label class="form-label fw-bold">Registered Shipping Address</label>

								<div class="list-group-item address-item d-flex justify-content-between align-items-center"
									ng-repeat="addr in userWithAddresses[currentUser.user_id].Addresses track by addr.ShippingId"
									ng-click="selectAddress(addr.ShippingId)"
									ng-class="{'active': selectedAddressId === addr.ShippingId}">

									<!-- Selection Indicator -->
									<div class="form-check me-3">
										<i class="fas fa-check-circle check-icon"
										ng-if="selectedAddressId === addr.ShippingId"></i>
									</div>

									<!-- Address Details -->
									<div class="flex-grow-1">
										<div class="text-muted medium">
										<i class="fas fa-user-circle me-3"></i>
										{{ addr.FullName }}
										<span class="badge bg-primary rounded-pill ms-2"
												ng-if="addr.IsDefault == 1">Default</span>
										</div>
										<div class="text-muted medium">
										<i class="fas fa-phone-square-alt me-3"></i>
										{{ addr.PhoneNumber }}
										</div>
										<div class="text-muted medium">
										<i class="far fa-address-book me-3"></i>
										{{ addr.Address }} | {{addr.Muni_Name}} | {{addr.Brgy_Name}} | {{ addr.PostalCode }}
										</div>
									</div>
								</div>

								<!-- <div class="list-group"
									ng-if="userWithAddresses[currentUser.user_id].Addresses.length > 0">
									<!-- Repeat each address
									<div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
										ng-repeat="addr in userWithAddresses[currentUser.user_id].Addresses track by addr.ShippingId">

										<!-- Radio Button
										<div class="form-check me-3">
											<input type="radio"
												class="form-check-input"
												name="selectedAddress"
												id="address{{$index}}"
												ng-model="selectedAddressId"
												ng-value="addr.ShippingId"
												ng-change="onAddressChange(addr.ShippingId)">
											<label class="form-check-label" for="address{{$index}}"></label>
										</div>

										<!-- Address Details
										<div class="flex-grow-1">
											<div class="text-muted medium">
												<i class="fas fa-user-circle me-3"></i>
												{{ addr.FullName }}

												<!-- Default Badge
												<span class="badge bg-primary rounded-pill ms-2"
													ng-if="addr.IsDefault == 1">Default</span>
											</div>
											<div class="text-muted medium">
												<i class="fas fa-phone-square-alt me-3"></i>
												{{ addr.PhoneNumber }}
											</div>
											<div class="text-muted medium">
												<i class="far fa-address-book me-3"></i>
												{{ addr.Address }} {{ addr.PostalCode }}
											</div>
										</div>
									</div>
								</div> -->
							</div>

							<!-- Show message if no addresses -->
							<div class="alert alert-warning mt-3"
								ng-if="!userWithAddresses[currentUser.user_id].Addresses || userWithAddresses[currentUser.user_id].Addresses.length === 0">
								<i class="fa-solid fa-triangle-exclamation me-2"></i>
								No shipping address found. Please
								<a href="#!/profile" class="alert-link">update your profile</a> to add one.
							</div>
						</div>
						<div ng-if="!isLoggedIn">
							<p>Please <a href="#!/login">login</a> to use saved addresses.</p>
						</div>
					</div>
				</div>
				<!-- /BILLING DETAILS -->

				<!-- ORDER DETAILS -->
				<div class="col-md-4 order-details">
					<div class="section-title text-center">
						<h3 class="title">Your Order</h3>
					</div>

					<div class="order-summary">
						<div class="order-col">
							<div><strong>PRODUCT</strong></div>
							<div><strong>TOTAL</strong></div>
						</div>

						<div class="order-products">
							<div class="order-col" ng-repeat="item in addedtoCart">
								<div>{{item.quantity}} x {{item.name}}</div>
								<div>₱{{ item.price * item.quantity | number:2 }}</div>
							</div>
						</div>

						<div class="order-col">
							<div>Shipping</div>
							<div><strong>₱ {{shipRates | number: 2}}</strong></div>
						</div>

						<div class="order-col">
							<div><strong>TOTAL</strong></div>
							<div><strong class="order-total">₱{{ getTotal() | number:2 }}</strong></div>
						</div>
					</div>

					<div class="order-summary">
						<!-- Delivery Method Selection -->
						<div class="mb-4">
							<label class="form-label fw-bold">Choose Delivery Method</label>
							<div>
								<div class="address-item"
									ng-click="selectDeliveryMethod('delivery')"
									ng-class="{'active': deliveryMethod === 'delivery'}">
									<i class="fas fa-truck me-2"></i> Delivery
								</div>
								<div class="address-item"
									ng-click="selectDeliveryMethod('pickup')"
									ng-class="{'active': deliveryMethod === 'pickup'}">
									<i class="fas fa-store me-2"></i> Store Pick-up
								</div>
							</div>
						</div>

						<!-- Payment Method (only for delivery) -->
						<div ng-if="deliveryMethod === 'delivery'" class="mt-4" style="padding-top:10px">
							<label class="form-label fw-bold">Payment Method</label>
							<div>
								<div class="address-item"
									ng-click="selectPaymentMethod(1)"
									ng-class="{'active': paymentType === 1}">
									Cash On Delivery
								</div>
								<div class="address-item"
									ng-click="selectPaymentMethod(2)"
									ng-class="{'active': paymentType === 2}">
									Gcash/Maya
								</div>
							</div>
							<div ng-if="isShowImage">
								<form id="uploadForm" enctype="multipart/form-data">
									<input type="file" accept="image/*" name="imageInput" ng-model="img_location"
										id="imageInput"
										onchange="angular.element(this).scope().uploadImage(this.files)">
									<img id="previewImage" alt="Image Preview"
										style="width: 100px; height: 100px;">
									<br>
								</form>
							</div>							
						</div>




						<!--
						<div class="order-col">
							<div><strong>PAYMENT METHOD</strong></div>
							<div><strong></strong></div>
						</div>

						<div class="order-products">
							<div class="form-check me-3">
								<input class="form-check-input" type="radio" name="paymentType" ng-model="paymentType"
									ng-value="1" ng-change="showImage(1)">
								<label> Cash on Delivery </label>
							</div>
							<div class="form-check me-3">
								<input class="form-check-input" type="radio" name="paymentType" ng-model="paymentType"
									ng-value="2" ng-change="showImage(2)">
								<label> Gcash/Maya</label>
							</div>

							<div ng-if="isShowImage">
								<form id="uploadForm" enctype="multipart/form-data">
									<input type="file" accept="image/*" name="imageInput" ng-model="img_location"
										id="imageInput"
										onchange="angular.element(this).scope().uploadImage(this.files)">
									<img id="previewImage" alt="Image Preview"
										style="width: 100px; height: 100px;">
									<br>
								</form>
							</div>
						</div> 
							<div class="form-check">
							<input class="form-check-input" type="radio" ng-model="paymentType" ng-value="1" ng-change="showImage(1)">
							<label class="form-check-label">Cash on Delivery</label>
							</div>
							<div class="form-check">
							<input class="form-check-input" type="radio" ng-model="paymentType" ng-value="2" ng-change="showImage(2)">
							<label class="form-check-label">Gcash/Maya</label>
							</div>
						-->


					</div>

					<button class="primary-btn order-submit" ng-click="proceedCheckOut()"
						ng-disabled="!userWithAddresses[currentUser.user_id].Addresses || userWithAddresses[currentUser.user_id].Addresses.length === 0">Place
						order</button>
				</div>
				<!-- /ORDER DETAILS -->

			</div>
		</div>
	</div>
	<!-- /SECTION -->

</div>